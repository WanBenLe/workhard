Diagnosing Sample Ratio Mismatch in Online Controlled Experiments: A Taxonomy and Rules of Thumb for Practitioners, Aleksander Fabijan, KDD, 2019

在线对照实验OCE存在SRM(样本比率不匹配)问题
一些无聊的解释(仅用于意会)
实验分配:将流量干成若干组,常见的层. 域,还有分桶
遥测:收集用户的若干行为,例如说,埋点,上传感器之类的
变体:AB测试里面的A和B就是变体
触发:例如listing上架了才算进组
过滤:如果说listing visit 一天超过10000当作异常数据剔除

SRM会动摇AB测试的效果,实际上,在初次均衡的后产生SRM时,已经带来了样本选择bias(而非自选择bias,因此PSM-DID无法解决)
1. 处理SRM的分析师需要经常接触SRM且能确定其根本原因
2. SRM是一个关键的数据质量问题,需要在对实验结果做出最终决定之前进行调查和解决
可以上卡方检验是否存在SRM 
较低时间粒度的对照组/测试组样本量观测可以观察SRM发生的时间

1. 实验分配SRM
a. 重复分配一致
b. 等概率随机分配
c. 实验间独立

2. 实验执行SRM
a. 实验变体交付(e. g. 实验组间开始时间不一致)
b. 变体执行(e. g. 实验组过滤不成功)
c. 遥测行为(e. g埋点错误增加了数据)
实验执行SRM可能需要使用高级方法归因(例如对SRM行为modeling)
引入第一个遥测信号,在任何其他代码执行之前发出(三次握手的第一次),可用于确定用户是否进组,但要与其他数据质量度量一起使用,以避免在数据丢失的情况下得出任何有偏见的结论

3. 实验日志处理SRM
数据从原始遥测转换为不同级别(会话级别. 用户级别)的汇总统计时的聚合/合并/过滤/汇总使得数据质量下降导致的SRM
监控被排除在分析之外的日志记录的大小和类型(例如被排除的机器人,被下架的listing等)
确保用户在被触发进入本地系统的实验之前不会受到处理
实验日志处理SRM基本都是处理后选择bias,因当避免处理后数据用于过滤

4. 实验分析SRM
a. 分析配置错误或反事实观测设置不正确
b. 不正确的触发/过滤条件
累计样本量计算方法判定
计算首次用户的SRM比率
从实验开始分析
若样本大小于过滤/触发条件难以平衡,放宽条件扩大样本量
(e. g. 若购买会产生问题,使用visit而非orders衡量)

5. 实验干扰SRM
a. 变体干扰,即实验者/最终用户参与了实验
b. 遥测干扰SRM:遥测被黑客攻击了
监控遥测异常值,提示实验者停止变体的后果

经验法则
1. 检查评分卡
例如说标准评分卡正常但是触发/过滤评分卡错误,那可能是后者错误可以通过放松条件检查SRM发生点
2. 检查用户细分
特定细分有问题可能是这细分相关产生的错误
3. 检查时间段
例如第一天的SRM就可能是第一天有组实验上晚了
4. 分析性能
如果你的系统卡的不行,那么实验可能就没法正常跑
5. 分析参与度指标
好/坏的处理增加/减少了用户的参与度(例如大幅度白嫖的薅羊毛)
6. SRM频率
如果嘛实验都能SRM,你的实验平台可能系统性大灭,大灭爹死
7. AA实验
AA实验之上的问题导致了SRM,或者这个AA是你以为的
8. 检查严重程度
如果SRM很严重,那大概率是个分变体的影响的大问题
9. 检查下游
上下游数据差异分析
10. 跨管道检查
类似于多重AB测试,可以互相校验

