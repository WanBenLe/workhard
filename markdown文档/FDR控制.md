

$$ \alpha(w)=\frac{D-E[D|X,A]}{E(D-E[D|X,A])^{2}}$$

$$ \alpha_{s}(w^{s})=\frac{D-E[D|X]}{E(D-E[D|X])^{2}}$$



$$\theta_{s}-\theta=E(g_{s}-g)(\alpha_{s}-\alpha)$$

$$|\theta_{s}-\theta|^{2}=\rho^{2}B^{2}\le B^{2}$$

$$B^{2}:=E(g-g_{s})^{2}(\alpha-\alpha_{s})^{2}$$

$$\rho^{2}=Cor^{2}(g-g_{s},\alpha-\alpha_{s})$$



$$B^{2}=S^{2}C_{Y}^{2}C_{D}^{2}$$

$$S^{2}:=E(Y-g_{s})^{2}E\alpha_{s}^{2}$$

$$C_{Y}^{2}:=\frac{E(g-g_{s})^{2}}{E(Y-g_{s})^{2}}=R^{2}_{Y-g_{s} \sim g-g_{s}}$$

$$C_{D}^{2}:=\frac{E\alpha^{2}-E\alpha^{2}_{s}}{E\alpha^{2}_{s}}=\frac{1-R^{2}_{\alpha \sim \alpha_{s}}}{R^{2}_{\alpha \sim \alpha_{s}}}$$

对于二元处理

$$C_{D}^{2}=\frac{E[1/(\pi(X,A)(1-\pi(X,A)))]}{E[1/(\pi(X)(1-\pi(X)))}-1$$

$$\pi(X)=P(D=1|X)$$

$$\pi(X,A)=P(D=1|X,A)$$



False Discovery in A/B Testing, Ron Berman, Management Science, 2022

$$FDR=Pr(\theta=0|z \in \Gamma)=\frac{\alpha \pi_{0}}{\alpha \pi_{0}+(1-\beta)(1-\pi_{0})}$$

$\alpha$是第一类错误,$\beta$是power,$\pi_{0}$是假设真实为0的概率

方法A

$$f(\hat{\theta_{i}})=\pi_{0}\phi(\hat{\theta_{i}};0,s^{2})+(1-\pi_{0})\phi(\hat{\theta_{i}};\mu,\sigma^{2}+s^{2})$$

$\phi(x;\lambda,\gamma^{2})$是正态分布pdf,使用MLE估计$\pi_{0},\mu,\sigma,s$

方法B

$$f(z_{i}|\hat{s_{i}})=\pi_{0}\phi(z_{i};0,1)+(1-\pi_{0})\phi(z_{i};\mu/\hat{s_{i}},1+\sigma^{2}/\hat{s_{i}}^{2})$$

$\hat{s_{i}}$为SE,使用MLE估计$\pi_{0},\mu,\sigma$

$$\hat{FDR}(z^{*})=\frac{\sum^{m}_{i=1}\hat{Pr}(\theta_{i}=0|\hat{s_{i}},|z|>z^{*})}{m}$$

方法C

H0是p值均匀分布,否则倾向于低值

![image-20221018103723932](C:\Users\SFC\AppData\Roaming\Typora\typora-user-images\image-20221018103723932.png)

1.记效应j的p值为$p_{j}$

2.对于$\lambda=0.05,0.1,...,0.95$计算

$$\pi_{0}(\lambda)=\frac{Count(p_{j}>\lambda)}{m(1-\lambda)}$$

3.拟合$\lambda.\pi_{0}(\lambda)$三次样条曲线$\hat{g}$

4.计算$\hat{\pi_{0}}=\hat{g}(1)$

$$\hat{FDR}(\alpha)=\frac{m\hat{\pi_{0}}\alpha}{Count(p_{j}\le \alpha)}$$

boostrap估计$\pi_{0}$的CI,FDR使用的$\alpha$有20%,10%,5%,1%,0.1%

错误发现的成本:

1.不作为的成本:因部署错误而非真实的发现而放弃的收益

2.佣金成本:部署错误发现而不是坚持当前做法所产生的成本

预期增益EG(请关注原文假设)为

$$EG=Pr(\theta \ne 0)Pr(\hat{\theta}/\hat{s}>z_{1-\alpha}|\theta \ne 0)E[\theta|\hat{\theta}/\hat{s}>z_{1-\alpha},\theta \ne 0]$$

EG随$\pi_{0},\hat{s},z_{1-\alpha}(z_{1-\alpha}>0)$减少,随$\mu,\sigma$增加,最大化EG应该$z_{1-\alpha}=0 \or \alpha=0.5$

$$EG=Pr(\hat{\theta}/\hat{s}>z_{1-\alpha})[1-FDR]E[\theta|\hat{\theta}/\hat{s}>z_{1-\alpha},\theta \ne 0]$$

考虑到一组重要的发现，预期的效果提升随着FDR的降低而降低.决策者可能不会只追求EG的最大化而不考虑部署错误发现的成本-对于某些实验来说,部署错误发现的成本很高.高层管理人员可能会担心部署错误的发现会损害他们灌输测试和学习文化的努力;分析团队可能会担心他们在公司内的信誉;决策者和分析师可能更关心避免损失,而不是取得同样大小的收益,因此可能希望提高显著性水平,以避免部署了错误发现.

根据他们的转换和失望的成本以及他们的损失厌恶程度,决策者和分析家可能希望在他们的决策规则中使用$\alpha<0.5$的值.部署错误发现放弃了实验的预期收益并产生了各种成本,放弃这些收益的后果在不同的组织中可能有所不同-如拥有大量网站访问量和大量分析和工程资源的大型组织将能够迅速发现缺乏改进的问题,并将有资源来测试新的想法和实施改进,与较小的组织相比,他们将在较短的时间内放弃真正发现的收益,但同样的组织在大规模运作时,通常会关心被放弃的非常小的改进.



降低FDR

1.收紧$\alpha$,会降低power

2.增加power,需要更多的样本量(更长的运行时间)

3.分层算法减少误差方差来提高power,但是需要相关协变量(CPUED?)和更复杂的算法,而且对power的提升有限

可以同时在事前确定power和FDR目标,并以此设计AB测试

$\alpha=Power \frac{FDR}{1-FDR}\frac{1-\pi_{0}}{\pi_{0}}$

![image-20221018112334345](C:\Users\SFC\AppData\Roaming\Typora\typora-user-images\image-20221018112334345.png)

但如果$\pi_{1}=0.75$,样本量需要目前中位数的10倍,如果$\pi_{1}=0.5$,后者会扩大为50倍,即提高样本量是不有效的.



更合理的方法是做两阶段AB测试:

1.第一次运行多个处理的AB测试

2.第二次只运行最显著的

3.优化分割总样本

4.设置不同的FDR和Power控制样本量



a.两阶段设计比单阶段设计在Power上有很大的提升,并降低了FDR

b.但是将受试者平均分配到各阶段并不是很容易

另一种做法是只进行一个有多种干预措施的实验,将样本分成探索性和验证性两部分,使用探索性子样本来确定最有希望的候选干预措施,然后使用另一个子样本来验证和评估该候选措施,后者可以压缩时间窗的好处,但前提是有足够的受试者用于两个子样本.

涉及多个处理方法的两步法允许人们从几个候选的效果大小中找出最有希望的,在增加power的同时降低了FDR,因为最大效应不太可能来自于无效效应,因此当真实效应的分布呈现长尾时该方法特别有价值



A/B测试的一些挫折来自于被测试的干预措施的无效性,而不是来自于方法本身的不足.更有经验的实验者倾向于实现较低的FDR,而实验中的变体或目标的数量与较高或较低的FDR没有关系.经验和FDR之间的负相关关系通过较低的FDR和较大的真效应大小呈现.在这个平台上最大量使用A/B测试的行业的FDR较低,但数据不允许我们确定这种关联是否与学习.更大的样本量或自我选择有关.



$\pi_{0}=70\%$的估计值意味可能着:

1.管理者很难产生好的想法来通过A/B测试进行评估:这可能代表着

a.他们目前的做法已经接近最佳状态

b.目标函数在最佳状态周围的大范围内变化不大

2.管理者由于缺乏勤奋.天赋或技能而难以产生好的想法

3.实验者主要是通过对当前实践的小的偏离来进行刻意的局部搜索

因此无法推断使用A/B测试的普通公司已经在接近最佳状态下运作



对于决策者:

1.对你在测试要有现实的期望:大约70%的效果可能真无效的,只有20%的效果在$\alpha=5\%$时是显著的

2.对推出测试优胜者的成功要有现实的期望:在$\alpha=5\%$时击败基线的干预措施中,5个有1个在部署的时候效应为0

3.为了降低假阳性需要更多考虑AB测试设计和相关风险

4.持续努力

对于分析师:

1.为了降低FDR,考虑使用带复制的两阶段AB测试设计和带有多变体的A/B/n测试

2.考虑$\alpha$设置,如果目标是使有效性的预期收益最大化或使有效性的遗憾最小化,那么在单边测试中设置$\alpha=50\%$是最佳选择.

最佳FDR有关的的五个要素应该被考虑:

1.实验EG的预期收益

2.运行一定规模的实验的设置成本3

3.发现的转换成本

4.错误发现的失望成本

5.损失厌恶程度

最佳的FDR将是这些组成部分的权重的函数,而这些权重很可能在不同的决定和背景下有所不同

